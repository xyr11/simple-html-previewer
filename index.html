<!DOCTYPE html>
<!--[if lte IE 9]>
<html class="ie" lang="en">
<![endif]-->
<!--[if gt IE 9]><!-->
<html lang="en" id="body">
<!--<![endif]-->

<head>
  <meta charset="UTF-8">
  <title>Simple HTML Previewer</title>
  <link rel="shortcut icon" href="favicon.png" type="image/x-icon">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="main.css" rel="stylesheet">
  <style>
    html {
      overflow: hidden;
    }

    /* header */
    header button {
      background-color: transparent;
      border: 0px transparent;
      border-radius: 4px;
      padding: 2px 8px;
      color: var(--body-color);
      cursor: pointer;
      transition: color .3s, background-color .3s, opacity .3s;
      outline: 0;
    }
    header button:hover, header button:focus {
      opacity: 0.6;
    }

    /* columns */
    /* i used float here so that they're supported on IE */
    .col {
      width: 100%;
    }
    .ver main::after {
      content: "";
      display: table;
      clear: both;
    }
    .ver .col {
      width: initial;
      float: left;
    }
    #col1, #col2 {
      box-shadow: 0 1px 5px rgba(0,0,0,0.2);
    }

    /* content */
    #content {
      display: block;
      color: var(--body-color);
      background-color: var(--dark-bg);
      transition: color .3s, background-color .3s;
      margin: 0;
      padding: 1em;
      width: 100%;
      height: 100%;
      border: 0;
      font-family: "Cascadia Code", monospace;
      font-size: .8em;
      overflow: auto;
      resize: none;
      outline: none;
    }
    
    /* preview */
    #preview {
      width: 100%;
      height: 100%;
      background-color: white;
      border: 0px;
    }

    /* dragbar */
    #dragbar {
      margin: 0;
      padding: 0;
      display: block;
      cursor: grab;
      background: var(--medium-bg);
      transition: background .3s, opacity .3s;
    }
    #dragbar:hover {
      opacity: 0.2;
    }
  </style>
</head>

<body onresize="resize()">
  <header id="header">
    <h1>Simple HTML Previewer</h1>
    <nav>
      <span id="blurb"></span> ‚Ä¢ <a href="about.html">About</a> ‚Ä¢ <a href="credits.html">Credits</a> ‚Ä¢ <a href="https://github.com/xyr11/simple-html-previewer">GitHub</a>
    </nav>
    <button id="indent" title="Add indentation to your code" onclick="iNdent()">üîß Indent</button>
    <button id="orient" title="Toggle orientation">üîÅ Vertical</button>
    <button id="copy" title="Copy code" onclick="copy()">üìù Copy</button>
    <button id="export" title="Export code as HTML" onclick="xport()">üíæ Export</button>
    <!--[if !IE]><!-->
    <label id="theme-wrap" class="switch" title="Toggle theme">
      <input type="checkbox" id="theme" onclick="toggle()" checked>
      <span class="slider"><i id="slider-inside"></i></span>
    </label>
    <!--<![endif]-->
  </header>
  <noscript style="position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.3);cursor:not-allowed"><div style="padding:35px;width:80%;max-width:480px;height:70%;max-height:240px;margin:auto;margin-top:80px;text-align:center;color:white;background-color:#121212;border:4px solid #ff0;font-size:16px;box-shadow:0 1px 16px #000;overflow:auto;cursor:help"><h2 style="margin: 10px 0 25px 0;">‚ö†Ô∏è Enable Javascript ‚ö†Ô∏è</h2><p>If you see this message, it means that your browser currently doesn't allow Javascript code. If you can, please enable it for this page to work, or switch to a Javascript-capable browser.</p></div></noscript>
  <main>
    <div class="col" id="col1">
      <textarea id="content" type="text" onchange="update()" onkeyup="this.onchange()" onpaste="this.onchange()" oninput="this.onchange()" autocomfplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
    </div>
    <a class="col" href="javascript:void(0)" id="dragbar"></a>
    <div class="col" id="col2">
      <iframe id="preview"></iframe>
    </div>
  </main>
  <script src="https://cdn.jsdelivr.net/gh/xyr11/simple-html-previewer@latest/version.js" type="text/javascript"></script>
  <script src="js/indenter.js" type="text/javascript"></script>
  <script src="js/cssVarsPonyfill.js" type="text/javascript"></script>
  <script src="js/classListPolyfill.js" type="text/javascript"></script>
  <script src="js/matchMediaPolyfill.js" type="text/javascript"></script>
  <script src="js/main.js" type="text/javascript"></script>
  <script>
    function elm (id) { return typeof id === "string" ? document.getElementById(id) : '' }

    var cont = elm('content')
    var body = elm('body')

    // Update live preview
    var cacheContent
    function update() {
      if (cacheContent !== cont.value) {
        var doc = elm('preview').contentWindow.document
        doc.write(cont.value)
        doc.close()
        cacheContent = cont.value
      }
    }

    function copy() { // Copy code
      cont.select()
      cont.setSelectionRange(0, 99999) // for mobile
      document.execCommand('copy')
    }
    
    function iNdent() { // Indent
      if (cont.value) {
        var type
        do { type = prompt('What type of indentation? [spaces / tabs]') } while (type!=='tabs' && type!=='spaces' && type!==null)
        if(type) cont.value = indent.js(cont.value, {tabString: type === 'tabs' ? '	' : '  '})
      }
    }

    // orient
    var orId = elm('orient'), ori = window.matchMedia('(hover: none)').matches ? false : true
    ori ? body.classList.add('ver') : body.classList.remove('ver')
    orId.addEventListener('click', function() {
      ori = !ori; resize()
      orId.innerHTML = ori ? 'üîÅ Vertical' : 'üîÅ Horizontal'
      ori ? body.classList.add('ver') : body.classList.remove('ver')
    })

    // resize page
    var c1S = 0.5, // 50%
    header = elm('header'),
    c1 = elm('col1'),
    c2 = elm('col2'),
    drag = elm('dragbar')

    function resize() {
      var mainHeight = body.clientHeight - header.scrollHeight
      var mainWidth = body.clientWidth
      if (ori) {
        c1.style.height = mainHeight + 'px'
        c2.style.height = mainHeight + 'px'
        drag.style.height = mainHeight + 'px'
        c1.style.width = (mainWidth * c1S - 6) + 'px'
        c2.style.width = (mainWidth * (1-c1S) - 5) + 'px'
        drag.style.width = '10px'
        drag.style.cursor = "col-resize"
      } else {
        c1.style.height = (mainHeight * c1S - 6) + 'px'
        c2.style.height = (mainHeight * (1-c1S) - 5) + 'px'
        drag.style.height = '10px'
        c1.style.width = (mainWidth - 1) + 'px'
        c2.style.width = (mainWidth - 1) + 'px'
        drag.style.width = mainWidth + 'px'
        drag.style.cursor = "row-resize"
      }
    }

    // dragging
    // some code i found on w3school's script
    var drg = false
    function dragstart (e) { e.preventDefault(); drg = true }
    function dragmove (e) {
      if (!drg) { return }
      // mouse position
      event = event || window.event // IE
      if (e.pageX == null && e.clientX != null) { // IE
        eventDoc = (e.target && e.target.ownerDocument) || document
        doc = eventDoc.documentElement
        body = eventDoc.body
        e.pageX = e.clientX + (doc && doc.scrollLeft || body && body.scrollLeft || 0) - (doc && doc.clientLeft || body && body.clientLeft || 0)
        e.pageY = e.clientY + (doc && doc.scrollTop  || body && body.scrollTop  || 0) - (doc && doc.clientTop  || body && body.clientTop  || 0 )
      }
      // change size
      if (ori) c1S = (e.pageX + 5) / (window.innerWidth)
      else c1S = (e.pageY - header.scrollHeight + 5) / (body.clientHeight - header.scrollHeight);
      // update sizes
      resize()
    }
    function dragend() { drg = false; drag.style.cursor = "grab" }
    drag.addEventListener("mousedown", dragstart)
    drag.addEventListener("touchstart", dragstart) // mobile
    window.addEventListener("mousemove", dragmove)
    window.addEventListener("touchmove", dragmove) // mobile
    window.addEventListener("mouseup", dragend)
    window.addEventListener("touchend", dragend) // mobile

    function xport() { // Export
      if (!cont.value) return
      var name = prompt('Please enter the filename')
      if (name || name === '') {
        filename = (name || 'export') + '.html'
        var file = new Blob([cont.value], {type: 'text/html'})
        if (window.navigator.msSaveOrOpenBlob) window.navigator.msSaveOrOpenBlob(file, filename) // IE
        else {
          var a = document.createElement("a"), url = URL.createObjectURL(file)
          a.href = url; a.download = filename
          document.body.appendChild(a)
          a.click()
          setTimeout(function() { document.body.removeChild(a); window.URL.revokeObjectURL(url) }, 0)
        }
      }
    }

    // Prompt before leaving
    if (window.matchMedia('(-ms-high-contrast: active), (-ms-high-contrast: none)').matches) window.addEventListener('beforeunload', function(e) { if (cont.value)e.preventDefault(); e.returnValue = '' })

    update(); resize()
  </script>
</body>

</html>